<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>fm22_2p8_dac_ug</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title"><p>VA FileMan 22.2; Patch DI*22.2*8</p>
<p>Data Access Control (DAC) User Guide</p></h1>
</header>
<p><img src="./media/image1.jpeg" title="Department of Veterans Affairs official seal" alt="Department of Veterans Affairs official seal" style="width:2.375in;height:2.375in" /></p>
<p>August 2017</p>
<p>Department of Veterans Affairs (VA)</p>
<p>Office of Information and Technology (OI&amp;T)</p>
<p>Enterprise Program Management Office (EPMO)</p>
<p><span id="_Toc164751643" class="anchor"></span>Revision History</p>
<table>
<tbody>
<tr class="odd">
<td>Date</td>
<td>Revision</td>
<td>Description</td>
<td>Author</td>
</tr>
<tr class="even">
<td>08/07/2017</td>
<td>1.0</td>
<td>Initial Data Access Control (DAC) document released with VA FileMan Patch DI*22.2*8.</td>
<td>VA FileMan 22.2 Development Team</td>
</tr>
</tbody>
</table>
<p><img src="./media/image2.png" title="Note" alt="Note" style="width:0.3125in;height:0.3125in" /> <strong>REF:</strong> For the current patch history related to this software, see the Patch Module (i.e., Patch User Menu [A1AE USER]) on FORUM.</p>
<p>Table of Contents</p>
<p><a href="#_Toc164751643">Revision History ii</a></p>
<p><a href="#_Toc482181861">List of Figures iv</a></p>
<p><a href="#_Toc475436007">List of Tables v</a></p>
<p><a href="#introduction">1 Introduction 1</a></p>
<p><a href="#what-is-a-policy">1.1 What is a Policy? 1</a></p>
<p><a href="#creating-a-policy">1.2 Creating a Policy 1</a></p>
<p><a href="#create-the-rules">1.2.1 Create the Rules 1</a></p>
<p><a href="#create-the-policy">1.2.2 Create the Policy 2</a></p>
<p><a href="#distribution-files">1.3 Distribution Files 4</a></p>
<p><a href="#policy-editor">2 Policy Editor 7</a></p>
<p><a href="#policy">2.1 Policy 7</a></p>
<p><a href="#addremove-membersadding-rules">2.2 Add/Remove Members—Adding Rules 7</a></p>
<p><a href="#edit-a-policy">2.3 Edit a Policy 9</a></p>
<p><a href="#messages">2.3.1 Messages 10</a></p>
<p><a href="#available-fields">2.3.2 Available Fields 10</a></p>
<p><a href="#delete-a-policy">2.4 Delete a Policy 11</a></p>
<p><a href="#disable-a-policy">2.5 Disable a Policy 11</a></p>
<p><a href="#expandcollapse">2.6 Expand/Collapse 12</a></p>
<p><a href="#inquiry">2.7 Inquiry 13</a></p>
<p><a href="#functions-1">2.8 Functions 13</a></p>
<p><a href="#application-actions-1">2.9 Application Actions 14</a></p>
<p><a href="#test-policy">2.10 Test Policy 15</a></p>
<p><a href="#test-utility-output">2.10.1 Test Utility Output 16</a></p>
<p><a href="#select-new-policy">2.11 Select New Policy 17</a></p>
<p><a href="#policy-sets">2.12 Policy Sets 17</a></p>
<p><a href="#data-access-control-menu-diaccess">3 Data Access Control Menu [DIACCESS] 18</a></p>
<p><a href="#set-up-application-actions">3.1 Set Up Application Actions 19</a></p>
<p><a href="#editcreate-an-action-policy">3.2 Edit/Create an Action Policy 20</a></p>
<p><a href="#test-a-policy">3.3 Test a Policy 20</a></p>
<p><a href="#disable-a-policy-1">3.4 Disable a Policy 20</a></p>
<p><a href="#delete-a-policy-1">3.5 Delete a Policy 20</a></p>
<p><a href="#print-actionspolicies">3.6 Print Actions/Policies 21</a></p>
<p><a href="#policy-functions">3.7 Policy Functions 23</a></p>
<p><a href="#application-programming-interface-api">4 Application Programming Interface (API) 24</a></p>
<p><a href="#candodiac1-policy-evaluation">4.1 $$CANDO^DIAC1(): Policy Evaluation 24</a></p>
<p><a href="#examples">4.1.1 Examples 25</a></p>
<p><a href="#appendix-akey-di-variables">5 Appendix A—Key DI* Variables 26</a></p>
<p><a href="#appendix-bexported-di-functions">6 Appendix B—Exported DI* Functions 27</a></p>

<p><span id="_Toc482181861" class="anchor"></span>List of Figures</p>
<p><a href="#_Ref475447373">Figure 1: Creating a Policy using the Edit/Create a Policy Option—Sample Prompts and User Entries 7</a></p>
<p><a href="#_Ref475448299">Figure 2: DAC Policy Editor—Sample Policy 7</a></p>
<p><a href="#_Ref475448252">Figure 3: Creating a Rule for a Policy using the Add/Remove Members Action—Sample Prompts and User Entries (1 of 2) 8</a></p>
<p><a href="#_Ref475448105">Figure 4: Creating a Rule for a Policy using the Add/Remove Members Action—Sample Prompts and User Entries (2 of 2) 8</a></p>
<p><a href="#_Ref475449154">Figure 5: DAC Policy Editor —Sample Policy with Rules 9</a></p>
<p><a href="#_Toc482181903">Figure 6: Editing a Policy using the Edit a Policy Action—Sample Prompts and User Entries 9</a></p>
<p><a href="#_Toc482181904">Figure 7: DAC Policy Editor ScreenMan Form—Review/Edit a Sample Policy (1 of 3) 9</a></p>
<p><a href="#_Toc482181905">Figure 8: DAC Policy Editor ScreenMan Form—Review/Edit a Sample Policy (2 of 3) 10</a></p>
<p><a href="#_Toc482181906">Figure 9: DAC Policy Editor ScreenMan Form—Review/Edit a Sample Policy (3 of 3) 10</a></p>
<p><a href="#_Toc482181907">Figure 10: Deleting a Policy using the Delete a Policy Action—Sample Prompts and User Entries 11</a></p>
<p><a href="#_Toc482181908">Figure 11: Disabling a Policy using the Disable a Policy Action—Sample Prompts and User Entries 11</a></p>
<p><a href="#_Ref475453412">Figure 12: DAC Policy Editor—Sample Disabled Policy 12</a></p>
<p><a href="#_Toc482181910">Figure 13: Collapsing Members of a Policy using the Expand/Collapse Action—Sample Prompts and User Entries 12</a></p>
<p><a href="#_Ref475453587">Figure 14: DAC Policy Editor—Sample Display of a Policy with Members Collapsed together 12</a></p>
<p><a href="#_Toc482181912">Figure 15: Using the Inquiry Action—Sample Prompts and User Entries 13</a></p>
<p><a href="#_Toc482181913">Figure 16: Using the Functions Action—Sample Prompts and User Entries 13</a></p>
<p><a href="#_Toc482181914">Figure 17: Setting Application Actions using the Link to Appl Action—Sample Prompts and User Entries 14</a></p>
<p><a href="#_Ref475455268">Figure 18: DAC Policy Editor—Sample Policy with Linked Application Actions 14</a></p>
<p><a href="#_Ref475451922">Figure 19: Test Policy Action—Sample Prompts, User Entries, and Output Displayed in the VA FileMan Browser 15</a></p>
<p><a href="#_Toc482181917">Figure 20: Test Policy Action—Sample DI Variables in Use 16</a></p>
<p><a href="#_Toc482181918">Figure 21: Test Policy Action—Sample Execution Trace 16</a></p>
<p><a href="#_Toc482181919">Figure 22: Test Policy Action—Final Result 16</a></p>
<p><a href="#_Toc482181920">Figure 23: Test Policy Action—Sample Messages Generated Based on the Result 17</a></p>
<p><a href="#_Toc482181921">Figure 24: Select New Policy Action—Sample Prompts and User Entries 17</a></p>
<p><a href="#_Toc482181922">Figure 25: DAC Policy Editor—Sample New Policy 17</a></p>
<p><a href="#_Toc482181923">Figure 26: DAC Policy Editor—Sample Policy Sets 18</a></p>
<p><a href="#_Ref476567063">Figure 27: Set Up Application Actions Option—Sample Prompts and User Entries 19</a></p>
<p><a href="#_Toc482181925">Figure 28: Edit/Create an Action Policy Option—Sample Prompts and User Entries 20</a></p>
<p><a href="#_Ref477247630">Figure 29: Print Actions/Policies Option—Sample Prompts and User Entries: Summary 21</a></p>
<p><a href="#_Ref477247654">Figure 30: Print Actions/Policies Option—Sample Prompts and User Entries: Detailed 22</a></p>
<p><a href="#_Ref476566553">Figure 31: Policy Functions Option—Sample Prompts and User Entries 23</a></p>
<p><a href="#_Toc482181929">Figure 32: Exported DI* Functions 27</a></p>
<p><span id="_Toc475436007" class="anchor"></span>List of Tables</p>
<p><a href="#_Toc482181930">Table 1: Data Access Control—Files 4</a></p>
<p><a href="#_Toc482164939">Table 2: Data Access Control—Options 4</a></p>
<p><a href="#_Toc482181932">Table 3: Data Access Control—Protocols (Actions) 5</a></p>
<p><a href="#_Toc482181933">Table 4: Data Access Control—Routines 6</a></p>
<p><a href="#_Toc482181934">Table 5: Key DI* Variables 26</a></p>
<h1 id="introduction">Introduction</h1>
<p>VA FileMan has provided basic file access control since its inception. It allows Veterans Health Information Systems and Technology Architecture (VistA) applications to define letter-based codes that can be assigned to users to grant access to the data in a given file. This access could differ for various actions, such as:</p>
<ul>
<li><p>Reading data</p></li>
<li><p>Writing data</p></li>
<li><p>Access to the file’s data dictionary</p></li>
</ul>
<p>Kernel 8.0 released the File Access Security module. It expanded upon this concept via an explicit list in the NEW PERSON (#200) file of the files that each user may access and how.</p>
<p>Both of these methods permit or deny a user access to specific fields, or the file as a whole. Applications face an additional access control issue at the record level. Often users may view final or verified data but anything that is still considered “draft” is usually restricted via application options. Sensitive or “removed” (i.e., entered in error) data is often hidden. Actions available to take on a record can vary depending upon its current state or the credentials of an individual user.</p>
<p>VistA application developers have traditionally coded these behaviors, generally known as business rules, into their application options and remote procedure calls (RPCs). New Web clients are accessing data via services instead of RPCs. The Data Access Control (DAC) utility was developed to save those business rules in a place that can be called within a Web service. Applications can also use this tool directly within their own code for consistency. Potentially, VA FileMan application programming interfaces (APIs) could use this type of access control.</p>
<p>The Data Access Control utility, released with VA FileMan Patch DI*22.2*8, is based upon the XACML (eXtensible Access Control Markup Language) standard, an extension of XML. XACML assumes an attribute-based rule structure that can permit or deny a user access to a resource (e.g., a record in a file). It uses pre-defined target attribute values to match appropriate policies to the action being taken. Policies are made up of rules that can be combined as needed. This allows you to create simple or very complex access policies.</p>
<h2 id="what-is-a-policy">What is a Policy?</h2>
<p>A policy is a set of rules that specify who may access a record, and how. Attribute name-value pairs, called <strong>targets</strong>, determine if the policy applies to a record; a conjunction can be used to indicate if all targets <em>must</em> match the record, or if only one match suffices. Each rule in a policy can have its own targets, to return different results based on different attribute values. Policies can return a message when a result is determined, and/or execute M code to perform a task, such as logging a user’s access to the file.</p>
<h2 id="creating-a-policy">Creating a Policy</h2>
<p>When creating a policy you first identify the business rules that determine how to appropriately handle the data. For example, Lab wants to restrict who may view results before they are verified. In this example, a policy can be created for reading data from the LAB DATA (#63) file. This policy would have rules to permit or deny access based on the status of the result and the credentials of each user.</p>
<h3 id="create-the-rules">Create the Rules</h3>
<p>A rule can be created for each possible scenario that <em>must</em> be considered. You need to define the following:</p>
<ul>
<li><p><span class="underline">Target</span>—Criteria for applying the rule.</p></li>
<li><p><span class="underline">Condition</span>—Any conditions to be evaluated if the rule applies.</p></li>
<li><p><span class="underline">Result</span>—Result to return if the conditions are true.</p></li>
</ul>
<h4 id="target">Target</h4>
<p>The target is a set of attributes that determine if the rule applies to a record. The name and desired value of each attribute is stored in a sub-file with the rule. A conjunction can be used to indicate if all targets <em>must</em> match, or if at least one suffices to apply the rule.</p>
<h4 id="condition">Condition</h4>
<p>Rules can have additional conditions, which are simply Boolean expressions that are evaluated to determine the result of the rule, when it is applied. A condition points to an entry in the <a href="#policy_function_file">POLICY FUNCTION (#1.62)</a> file, and can include a value for comparison. Conditions are particularly useful for evaluating requirements that are external to the record, such as user credentials. For example, VA FileMan provides a condition function to check if the user holds a specified security key. A conjunction can be used to indicate if all conditions <em>must</em> be true, or at least one, for the rule to be considered true.</p>
<p><img src="./media/image2.png" title="Note" alt="Note" style="width:0.3125in;height:0.3125in" /> <strong>REF:</strong> For a list of exported DI* functions, see “<span class="underline">Appendix B—Exported DI* Functions</span>.”</p>
<h4 id="result">Result</h4>
<p>The result is the intended consequence or effect of the rule, if it applies and the conditions evaluate to true. Possible values are either:</p>
<ul>
<li><p>Permit</p></li>
<li><p>Deny</p></li>
</ul>
<p>Depending on the result of the rule, each rule can also:</p>
<ul>
<li><p>Return a message.</p></li>
<li><p>Process an obligation function.</p></li>
</ul>
<p>The function is M code stored as an entry in the <a href="#policy_function_file">POLICY FUNCTION (#1.62)</a> file. It is executed based on the result and can perform tasks, such as logging access that has been granted or denied.</p>
<p><img src="./media/image2.png" title="Note" alt="Note" style="width:0.3125in;height:0.3125in" /> <strong>REF:</strong> For a list of exported DI* functions, see “<span class="underline">Appendix B—Exported DI* Functions</span>.”</p>
<h3 id="create-the-policy">Create the Policy</h3>
<p>Related rules can be collected together into a single policy, which can be evaluated to permit or deny access to a record. A policy can have its own set of target attributes, as well as messages and functions.</p>
<p>A policy should also include an <strong>attribute function</strong>. This is M code that is stored as an entry in the <a href="#policy_function_file">POLICY FUNCTION (#1.62)</a> file, which extracts the attribute values from the record and stores them in the <strong>DIVAL</strong> array by subscripts that match the target names used in the policy and its rules.</p>
<p>Because a policy usually contains multiple rules, a <strong>result function</strong> <em>must</em> be defined as well. This is M code that is stored as an entry in the <a href="#policy_function_file">POLICY FUNCTION (#1.62)</a> file, which based on the current value of the local variable <strong>DIRESULT</strong> sets the local variable <strong>Y</strong> to either of the following:</p>
<ul>
<li><p><strong>1—</strong>True</p></li>
<li><p><strong>0—</strong>False</p></li>
</ul>
<p>A policy can loop through rules until the following:</p>
<ul>
<li><p><strong>Permit</strong> result occurs.</p></li>
<li><p><strong>Deny</strong> is encountered.</p></li>
<li><p>Quits when any result is determined.</p></li>
</ul>
<p>Some result functions can provide a default result if no policy or rule is found that applies to the record. VA FileMan provides five result functions that handle the most common combining algorithms.</p>
<p><img src="./media/image2.png" title="Note" alt="Note" style="width:0.3125in;height:0.3125in" /> <strong>REF:</strong> For more information on result functions, see the “<span class="underline">Functions</span>” section.</p>
<p><img src="./media/image2.png" title="Note" alt="Note" style="width:0.3125in;height:0.3125in" /> <strong>REF:</strong> For a list of exported DI* functions, see “<span class="underline">Appendix B—Exported DI* Functions</span>.”</p>
<h4 id="functions">Functions</h4>
<p>The <a href="#policy_function_file">POLICY FUNCTION (#1.62)</a> file contains the following function types:</p>
<ul>
<li><p><strong>Attribute—</strong>Written by the application developer to extract values from the record that are used to determine which policies and rules apply; it should populate the array DIVAL(“attribute”)=“value”, where ‘attribute’ matches the policy or rule targets.</p></li>
<li><p><strong>Obligation—</strong>Provided by the application developer to perform any needed tasks when a Permit or Deny result is obtained, such as logging access to a file. No input or output is required.</p></li>
<li><p><strong>Condition—</strong>Provides additional checks for rules that apply. VA FileMan exports a few common functions, but others can be provided by the developer as needed. A value can be specified to compare against, and is available for use in the function code as the variable <strong>X</strong>; the variable <strong>Y</strong> <em>must</em> be returned as:</p></li>
</ul>
<ul>
<li><p><strong>1—</strong>True</p></li>
<li><p><strong>0—</strong>False</p></li>
</ul>
<ul>
<li><p><strong>Result—</strong>Provided by VA FileMan; examine the variable DIRESULT to determine if a policy is satisfied. Like conditions, the variable <strong>Y</strong> is returned as either:</p></li>
</ul>
<ul>
<li><p><strong>1—</strong>True</p></li>
<li><p><strong>0—</strong>False</p></li>
</ul>
<p>When function code is executed, the variable IEN holds the pointer to the <a href="#policy_file">POLICY (#1.6)</a> file for the policy or rule being evaluated.</p>
<p><img src="./media/image2.png" title="Note" alt="Note" style="width:0.3125in;height:0.3125in" /> <strong>REF:</strong> For a list of exported DI* functions, see “<span class="underline">Appendix B—Exported DI* Functions</span>.”</p>
<p><img src="./media/image2.png" title="Note" alt="Note" style="width:0.3125in;height:0.3125in" /> <strong>REF:</strong> For the full list of local variables that can be referenced, see “<span class="underline">Appendix A—Key DI* Variables</span>.”</p>
<h4 id="application-actions">Application Actions</h4>
<p>The <a href="#application_action_file">APPLICATION ACTION (#1.61)</a> file contains the actions that can be taken on a record in a given VistA file or sub-file. Each entry consists of a valid VistA file or sub-file number, and the free text name of an action that is supported by its application (e.g., read, cancel, sign, etc.).</p>
<p>A policy can be linked to an Application Action. When the policy evaluation API is invoked, the file number and action name passed in are used to find a match in this file; its associated policy is then evaluated to return a data access authorization result of Permit or Deny. More than one Application Action can be assigned the same policy.</p>
<p><img src="./media/image2.png" title="Note" alt="Note" style="width:0.3125in;height:0.3125in" /> <strong>NOTE:</strong> A policy <em>must</em> be linked to an Application Action to be evaluated for Data Access Control.</p>
<h2 id="distribution-files">Distribution Files</h2>
<p>The Data Access Control (DAC) software uses the <strong>DIAC</strong> namespace.</p>
<p>The DAC software distributes the following files:</p>
<p><span id="_Toc482181930" class="anchor"></span>Table : Data Access Control—Files</p>
<table>
<caption>Data Access Control Files</caption>
<thead>
<tr class="header">
<th>Global</th>
<th>File (#)</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>^DIAC(1.6,</td>
<td><span id="policy_file" class="anchor"></span>POLICY (#1.6)</td>
<td>This file is a self-referring, namespaced file, which is similar to the OPTION (#19) file. Rules are stored in a sub-file, much like menu items, and evaluated in sequence. If more complex policies are needed, policy sets can be created by grouping other policies or sets, drilling down the levels in sequence like a menu tree.</td>
</tr>
<tr class="even">
<td>^DIAC(1.61,</td>
<td><span id="application_action_file" class="anchor"></span>APPLICATION ACTION (#1.61)</td>
<td>This file stores the list of actions that can be taken on a file or sub-file (e.g., read, cancel, sign, etc.). Each action can be mapped to a policy that is evaluated when that kind of access to data is requested.</td>
</tr>
<tr class="odd">
<td>^DIAC(1.62,</td>
<td><span id="policy_function_file" class="anchor"></span>POLICY FUNCTION (#1.62)</td>
<td>Supporting M code for policies is implemented as M functions and stored as entries in this file.</td>
</tr>
</tbody>
</table>
<p>The DAC software distributes the following options:</p>
<p><span id="_Toc482164939" class="anchor"></span>Table : Data Access Control—Options</p>
<table>
<caption>Data Access Control Files</caption>
<thead>
<tr class="header">
<th>Option Name</th>
<th>Option Text</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>DIACCESS</td>
<td>Data Access Control</td>
<td><p>This menu contains options that allow creation and management of Data Access Control policies for VistA files. It includes the following option items (listed in display order):</p>
<ul>
<li><p>Set Up Application Actions [DIAC ACTIONS]</p></li>
<li><p>Edit/Create an Action Policy [DIAC EDIT]</p></li>
<li><p>Test a Policy [DIAC TEST]</p></li>
<li><p>Disable a Policy [DIAC DISABLE]</p></li>
<li><p>Delete a Policy [DIAC DELETE]</p></li>
<li><p>Print Actions/Policies [DIAC PRINT]</p></li>
<li><p>Policy Functions [DIAC FUNCTIONS]</p></li>
</ul></td>
</tr>
<tr class="even">
<td>DIAC ACTIONS</td>
<td>Set Up Application Actions</td>
<td>This option provides access to the <a href="#application_action_file">APPLICATION ACTION (#1.61)</a> file, which allows the user to edit an existing or create a new Application Action.</td>
</tr>
<tr class="odd">
<td>DIAC DELETE</td>
<td>Delete a Policy</td>
<td>This option allows users to delete a DAC policy.</td>
</tr>
<tr class="even">
<td>DIAC DISABLE</td>
<td>Disable a Policy</td>
<td>This option provides a way to quickly disable a DAC policy.</td>
</tr>
<tr class="odd">
<td>DIAC EDIT</td>
<td>Edit/Create an Action Policy</td>
<td>This option provides access to the DAC Policy Editor.</td>
</tr>
<tr class="even">
<td>DIAC FUNCTIONS</td>
<td>Policy Functions</td>
<td>This option provides access to the <a href="#policy_function_file">POLICY FUNCTION (#1.62)</a> file, which allows the user to edit an existing or create a new Policy Function.</td>
</tr>
<tr class="odd">
<td>DIAC PRINT</td>
<td>Print Actions/Policies</td>
<td>This option allows users to print a summary list of application actions and their associated policies, or details of one policy.</td>
</tr>
<tr class="even">
<td>DIAC TEST</td>
<td>Test a Policy</td>
<td>This option allows users to test a DAC policy.</td>
</tr>
</tbody>
</table>
<p>The DAC software distributes the following protocols (actions):</p>
<p><span id="_Toc482181932" class="anchor"></span>Table : Data Access Control—Protocols (Actions)</p>
<table>
<caption>Data Access Control Files</caption>
<thead>
<tr class="header">
<th>Protocol Name</th>
<th>Protocol Text</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>DIAC ACTION MENU</td>
<td>Policy Action Menu</td>
<td><p>This action menu contains options that allow creation and management of Data Access Control policies for VistA files. It includes the following action items (listed in sequence order):</p>
<ul>
<li><p>Add/Remove Members [DIAC MEMBERS]</p></li>
<li><p>Edit a Policy [DIAC EDIT]</p></li>
<li><p>Delete a Policy [DIAC DELETE]</p></li>
<li><p>Blank Line [DIAC BLANK LINE]</p></li>
<li><p>Expand/Collapse [DIAC EXPAND]</p></li>
<li><p>Inquiry [DIAC INQUIRE]</p></li>
<li><p>Functions [DIAC FUNCTIONS]</p></li>
<li><p>Link to Appl Action [DIAC LINK ACTION]</p></li>
<li><p>Test Policy [DIAC TEST]</p></li>
<li><p>Select New Policy [DIAC CHANGE]</p></li>
<li><p>Quit [DIAC QUIT]</p></li>
</ul></td>
</tr>
<tr class="even">
<td>DIAC BLANK LIN</td>
<td>Blank Line</td>
<td>N/A</td>
</tr>
<tr class="odd">
<td>DIAC CHANGE</td>
<td>Select New Policy</td>
<td>This action allows the user to change the policy that is displayed in the list for editing.</td>
</tr>
<tr class="even">
<td>DIAC DELETE</td>
<td>Delete a Policy</td>
<td>This action completely removes a rule or policy from the <a href="#policy_file">POLICY (#1.6)</a> file, and cleans up all pointers to that item.</td>
</tr>
<tr class="odd">
<td>DIAC DISABLE</td>
<td>Disable a Policy</td>
<td>This action changes the value of the DISABLE (#.03) field in the <a href="#policy_file">POLICY (#1.6)</a> file.</td>
</tr>
<tr class="even">
<td>DIAC EDIT</td>
<td>Edit a Policy</td>
<td>This action invokes a ScreenMan form, which allows reviewing and editing of any rule or policy in the list.</td>
</tr>
<tr class="odd">
<td>DIAC EXPAND</td>
<td>Expand/Collapse</td>
<td>This action toggles the display to expanding a policy to see all of its rules or collapsing the members.</td>
</tr>
<tr class="even">
<td>DIAC FUNCTIONS</td>
<td>Functions</td>
<td>This action reviews existing functions or creates new ones.</td>
</tr>
<tr class="odd">
<td>DIAC INQUIRE</td>
<td>Inquiry</td>
<td>This action displays a snapshot of the selected item in VA FileMan captioned format. It also lists all policies or sets to which the selected item is itself a member.</td>
</tr>
<tr class="even">
<td>DIAC LINK ACTION</td>
<td>Link to Appl Action</td>
<td>This action assigns the policy to an Application Action.</td>
</tr>
<tr class="odd">
<td>DIAC MEMBERS</td>
<td>Add/Remove Members</td>
<td>This action creates a rule for the Preliminary (<strong>P</strong>) status.</td>
</tr>
<tr class="even">
<td>DIAC QUIT</td>
<td>Quit</td>
<td>This action quits an action.</td>
</tr>
<tr class="odd">
<td>DIAC TEST</td>
<td>Test Policy</td>
<td>This action tests a policy. It has an optional trace feature that shows the details of policy execution, including local variables.</td>
</tr>
</tbody>
</table>
<p>The DAC software distributes the following routines:</p>
<p><span id="_Toc482181933" class="anchor"></span>Table : Data Access Control—Routines</p>
<table>
<caption>Data Access Control Files</caption>
<thead>
<tr class="header">
<th>Routine</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>DIAC1</td>
<td>Policy Evaluation API.</td>
</tr>
<tr class="even">
<td>DIAC1T</td>
<td>Test utility for Policies.</td>
</tr>
<tr class="odd">
<td>DIACLM</td>
<td>Policy Editor driver.</td>
</tr>
<tr class="even">
<td>DIACLM1</td>
<td>Policy Editor actions.</td>
</tr>
<tr class="odd">
<td>DIACOPT</td>
<td>Data Access Control Options.</td>
</tr>
<tr class="even">
<td>DIACP</td>
<td>Print Policy Reports.</td>
</tr>
<tr class="odd">
<td>DIACX</td>
<td>Policy utilities.</td>
</tr>
</tbody>
</table>
<h1 id="policy-editor">Policy Editor</h1>
<p>The Data Access Control (DAC) utility provides a Policy Editor to facilitate creation and management of data access control policies. Policy members are indented in the list to show the membership hierarchy, with common actions and utilities available in the action menu below.</p>
<h2 id="policy">Policy</h2>
<p><span class="underline">Figure 1</span> and <span class="underline">Figure 2</span> are examples of creating a sample policy to view Chemistry results. Invoke the Policy Editor via the Data Access Control options on the VA FileMan Other Options menu, and create a new policy called LR CH READ.</p>
<p><span id="_Ref475447373" class="anchor"></span>Figure : Creating a Policy using the Edit/Create a Policy Option—Sample Prompts and User Entries</p>
<p>Select DATA ACCESS CONTROL OPTION: <strong>ED &lt;Enter&gt;</strong> IT/CREATE A POLICY</p>
<p>Select POLICY: <strong>LR CH READ</strong></p>
<p>Are you adding 'LR CH READ' as a new POLICY? No// <strong>Y &lt;Enter&gt;</strong> (Yes)</p>
<p>POLICY TYPE: <strong>P &lt;Enter&gt;</strong> policy</p>
<p><span id="_Ref475448299" class="anchor"></span>Figure : DAC Policy Editor—Sample Policy</p>
<p><span class="underline">Data Access Control Sep 27, 2016@13:50:55 Page: 1 of 1</span></p>
<p>For: &lt;no linked Application Action&gt;</p>
<p><span class="underline">Name Type Result .</span></p>
<p>1 LR CH READ policy</p>
<p>. Enter ?? for more actions .</p>
<p>Add/Remove Members Expand/Collapse Test Policy</p>
<p>Edit a Policy Inquiry Disable a Policy</p>
<p>Delete a Policy Functions Select New Policy</p>
<p>Link to Appl Action Quit</p>
<p>Select Action: Quit//</p>
<h2 id="addremove-membersadding-rules">Add/Remove Members—Adding Rules</h2>
<p>The content of the new policy consists of a rule for each possible status of a result. Use the <strong>Add/Remove Members</strong> action to create a rule for the Preliminary (<strong>P</strong>) status. If the rule does <em>not</em> exist, you are first allowed to create it and complete the most commonly used fields.</p>
<p><img src="./media/image2.png" title="Note" alt="Note" style="width:0.3125in;height:0.3125in" /> <strong>NOTE:</strong> The type of Rule is assumed, for policy members.</p>
<p>Finally, a Sequence number <em>must</em> be assigned for the new rule within the policy’s Members sub-file, as shown in <span class="underline">Figure 3</span>.</p>
<p><span id="_Ref475448252" class="anchor"></span>Figure : Creating a Rule for a Policy using the Add/Remove Members Action—Sample Prompts and User Entries (1 of 2)</p>
<p>Select Action: Quit// <strong>AD &lt;Enter&gt;</strong> Add/Remove Members</p>
<p>Select MEMBER: <strong>LR CH READ PRELIM</strong></p>
<p>Are you adding 'LR CH READ PRELIM' as a new POLICY (the 2ND)? No// <strong>Y &lt;Enter&gt;</strong> (Yes)</p>
<p>NAME: LR CH READ PRELIM// <strong>&lt;Enter&gt;</strong></p>
<p>Select TARGET: <strong>1</strong></p>
<p>Are you adding '1' as a new TARGETS (the 1ST for this POLICY)? No// <strong>Y &lt;Enter&gt;</strong> (Yes)</p>
<p>ATTRIBUTE: <strong>resultStatus</strong></p>
<p>VALUE: <strong>P</strong></p>
<p>Select TARGET: <strong>&lt;Enter&gt;</strong></p>
<p>Select CONDITION: <strong>1</strong></p>
<p>Are you adding '1' as a new CONDITIONS (the 1ST for this POLICY)? No// <strong>Y &lt;Enter&gt;</strong> (Yes)</p>
<p>FUNCTION: <strong>DI HAS KEY &lt;Enter&gt;</strong> CONDITION</p>
<p>VALUE: <strong>LRLAB</strong></p>
<p>Select CONDITION: <strong>&lt;Enter&gt;</strong></p>
<p>RESULT: <strong>P &lt;Enter&gt;</strong> PERMIT</p>
<p>DENY MESSAGE: <strong>You are not authorized to view preliminary results.</strong></p>
<p>DENY FUNCTION: <strong>&lt;Enter&gt;</strong></p>
<p>PERMIT MESSAGE: <strong>&lt;Enter&gt;</strong></p>
<p>PERMIT FUNCTION: <strong>&lt;Enter&gt;</strong></p>
<p>MEMBERS SEQUENCE: <strong>1</strong>// <strong>&lt;Enter&gt;</strong></p>
<p>Targets should be defined with a name and value that describe the desired rule. Use the VA FileMan <strong>DI HAS KEY</strong> function to check if the user holds the key named in the VALUE field.</p>
<p>If a rule that already exists is added to a policy, only the <strong>Members Sequence</strong> is prompted.</p>
<p>Create one more similar rule, to handle a result status of Final (<strong>F</strong>), as shown in <span class="underline">Figure 4</span>.</p>
<p><span id="_Ref475448105" class="anchor"></span>Figure : Creating a Rule for a Policy using the Add/Remove Members Action—Sample Prompts and User Entries (2 of 2)</p>
<p>Select MEMBER: <strong>LR CH READ FINAL</strong></p>
<p>Are you adding 'LR CH READ FINAL' as a new POLICY (the 3RD)? No// <strong>Y &lt;Enter&gt;</strong> (Yes)</p>
<p>NAME: LR CH READ FINAL// <strong>&lt;Enter&gt;</strong></p>
<p>Select TARGET: <strong>1</strong></p>
<p>Are you adding '1' as a new TARGETS (the 1ST for this POLICY)? No// <strong>Y &lt;Enter&gt;</strong> (Yes)</p>
<p>ATTRIBUTE: <strong>resultStatus</strong></p>
<p>VALUE: <strong>F</strong></p>
<p>Select TARGET: <strong>&lt;Enter&gt;</strong></p>
<p>Select CONDITION: <strong>1</strong></p>
<p>Are you adding '1' as a new CONDITIONS (the 1ST for this POLICY)? No// <strong>Y &lt;Enter&gt;</strong> (Yes)</p>
<p>FUNCTION: <strong>DI HAS KEY</strong></p>
<p>VALUE: <strong>PROVIDER</strong></p>
<p>Select CONDITION: <strong>2</strong></p>
<p>Are you adding '2' as a new CONDITIONS (the 2ND for this POLICY)? No// <strong>Y &lt;Enter&gt;</strong> (Yes)</p>
<p>FUNCTION: <strong>DI HAS KEY</strong></p>
<p>VALUE: <strong>LRLAB</strong></p>
<p>Select CONDITION: <strong>&lt;Enter&gt;</strong></p>
<p>CONDITION CONJUNCTION: <strong>! &lt;Enter&gt;</strong> OR</p>
<p>RESULT: <strong>P &lt;Enter&gt;</strong> PERMIT</p>
<p>DENY MESSAGE: <strong>You are not authorized to view lab results.</strong></p>
<p>DENY FUNCTION: <strong>&lt;Enter&gt;</strong></p>
<p>PERMIT MESSAGE: <strong>&lt;Enter&gt;</strong></p>
<p>PERMIT FUNCTION: <strong>&lt;Enter&gt;</strong></p>
<p>MEMBERS SEQUENCE: 2// <strong>&lt;Enter&gt;</strong></p>
<p>This rule can be satisfied if the user holds either one of the keys, so two conditions are created; a condition conjunction is then needed to indicate that only one condition needs to be true.</p>
<p>Press <strong>Enter</strong> when finished to exit editing, and redisplay the list showing the hierarchy, as shown in <span class="underline">Figure 5</span>.</p>
<p><span id="_Ref475449154" class="anchor"></span>Figure : DAC Policy Editor —Sample Policy with Rules</p>
<p><span class="underline">Data Access Control Sep 27, 2016@13:59:53 Page: 1 of 1</span></p>
<p>For: &lt;no linked Application Action&gt;</p>
<p><span class="underline">Name Type Result .</span></p>
<p>1 -LR CH READ policy</p>
<p>2 LR CH READ PRELIM rule PERMIT</p>
<p>3 LR CH READ FINAL rule PERMIT</p>
<p>. Enter ?? for more actions .</p>
<p>Add/Remove Members Expand/Collapse Test Policy</p>
<p>Edit a Policy Inquiry Disable a Policy</p>
<p>Delete a Policy Functions Select New Policy</p>
<p>Link to Appl Action Quit</p>
<p>Select Action: Quit//</p>
<h2 id="edit-a-policy">Edit a Policy</h2>
<p>The <strong>Edit a Policy</strong> action invokes a ScreenMan form, which allows reviewing and editing of any rule or policy in the list. All fields are presented for editing, but <em>not</em> all need to be completed for every rule or policy. For example, an Attribute Function is usually only defined for the policy, and <em>not</em> needed for every rule as well.</p>
<p>Besides its Name, only the Result or Result Function is required for rules or policies, respectively. The Conjunction fields are optional unless more than one target or condition is entered.</p>
<p><span id="_Toc482181903" class="anchor"></span>Figure : Editing a Policy using the Edit a Policy Action—Sample Prompts and User Entries</p>
<p>Select Action: Quit// <strong>ED &lt;Enter&gt;</strong> Edit a Policy</p>
<p>Select Item(s): (1-3): <strong>3</strong></p>
<p>Loading form to edit #3 ...</p>
<p><span id="_Toc482181904" class="anchor"></span>Figure : DAC Policy Editor ScreenMan Form—Review/Edit a Sample Policy (1 of 3)</p>
<p>Edit Rule</p>
<p>NAME: LR CH READ FINAL Page 1 of 3</p>
<p>-------------------------------------------------------------------------------</p>
<p><span class="underline">NAME</span>: LR CH READ FINAL</p>
<p>DESCRIPTION:</p>
<p># Attribute Name Value</p>
<p>1 resultStatus F</p>
<p>ATTRIBUTE FUNCTION:</p>
<p>CONJUNCTION:</p>
<p>_______________________________________________________________________________</p>
<p>Exit Save Next Page Refresh</p>
<p>Enter a command or '^' followed by a caption to jump to a specific field.</p>
<p>COMMAND: <strong>N</strong> Press &lt;PF1&gt;H for help Insert</p>
<p><span id="_Toc482181905" class="anchor"></span>Figure : DAC Policy Editor ScreenMan Form—Review/Edit a Sample Policy (2 of 3)</p>
<p>Edit Rule</p>
<p>NAME: LR CH READ FINAL Page 2 of 3</p>
<p>-------------------------------------------------------------------------------</p>
<p># Condition Parameter</p>
<p>1 DI HAS KEY PROVIDER</p>
<p>2 DI HAS KEY LRLAB</p>
<p><span class="underline">RESULT</span>: PERMIT</p>
<p>CONJUNCTION: OR</p>
<p>_______________________________________________________________________________</p>
<p>Exit Save Next Page Refresh</p>
<p>Enter a command or '^' followed by a caption to jump to a specific field.</p>
<p>COMMAND: <strong>N</strong> Press &lt;PF1&gt;H for help Insert</p>
<p><span id="_Toc482181906" class="anchor"></span>Figure : DAC Policy Editor ScreenMan Form—Review/Edit a Sample Policy (3 of 3)</p>
<p>Edit Rule</p>
<p>NAME: LR CH READ FINAL Page 3 of 3</p>
<p>-------------------------------------------------------------------------------</p>
<p>ON DENY - FUNCTION:</p>
<p>MESSAGE: |DIUSRNM| is not authorized to view lab results.</p>
<p>ON PERMIT - FUNCTION:</p>
<p>MESSAGE:</p>
<p>AVAILABLE FIELDS:</p>
<p>Select ADDL FIELDS:</p>
<p>_______________________________________________________________________________</p>
<p>Exit Save Next Page Refresh</p>
<p>Enter a command or '^' followed by a caption to jump to a specific field.</p>
<p>COMMAND: <strong>E</strong> Press &lt;PF1&gt;H for help Insert</p>
<h3 id="messages">Messages</h3>
<p>Advice messages can contain dynamic text, if needed, by using the VA FileMan text bar syntax; in the above example, the name of the user is inserted into the Deny Message when returned. The name of a local variable, or the name of an attribute (i.e., a subscript) in the DIVAL array, can be placed between two vertical bars; when the message is returned, the value of the variable or attribute is inserted into the text.</p>
<p><img src="./media/image2.png" title="Note" alt="Note" style="width:0.3125in;height:0.3125in" /> <strong>REF:</strong> For the full list of local variables that can be referenced, see “<span class="underline">Appendix A—Key DI* Variables</span>.”</p>
<h3 id="available-fields">Available Fields</h3>
<p>Not every action on a file requires accessing every field; a developer may want to specify the fields that are appropriate to view or modify. Available Fields can hold a string that can be used as the DR variable in any standard VA FileMan API call. This string is returned to the calling client or application when a Permit result is obtained. Continuation strings, or specific fields within a sub-file, can be included by creating an entry in the Additional Fields list.</p>
<p>Field strings can be saved at any level of a policy hierarchy, including the associated Application Action. The lowest level in the hierarchy that determined the Permit result takes precedence, and its DR string is returned. It is <em>recommended</em> that a default field string be saved at the highest level appropriate, for example with the Action or primary Policy. If exceptions are needed, they should be saved with the rule that grants access under those conditions to override the default string.</p>
<h2 id="delete-a-policy">Delete a Policy</h2>
<p>A rule or policy can be removed from the current policy tree by using either the <strong>Add/Remove Members</strong> or <strong>Edit a Policy</strong> action. The <strong>Delete a Policy</strong> action completely removes a rule or policy from the <a href="#policy_file">POLICY (#1.6)</a> file, and cleans up all pointers to that item.</p>
<p><span id="_Toc482181907" class="anchor"></span>Figure : Deleting a Policy using the Delete a Policy Action—Sample Prompts and User Entries</p>
<p>Select Action: Quit// <strong>DE &lt;Enter&gt;</strong> Delete</p>
<p>Select Item (1-3): <strong>2 &lt;Enter&gt;</strong> LR CH READ PRELIM</p>
<p>LR CH READ PRELIM will also be removed as a member from:</p>
<p>LR CH READ</p>
<p>Are you sure? NO// <strong>?</strong></p>
<p>Enter NO if you only want to remove this item as a member of a policy.</p>
<p>Enter YES to delete this item from the file; it will also be removed as</p>
<p>a Member from its parent policies.</p>
<p>Are you sure? NO// <strong>&lt;Enter&gt;</strong></p>
<p>Nothing deleted!</p>
<h2 id="disable-a-policy">Disable a Policy</h2>
<p>The <strong>Disable a Policy</strong> action changes the value of the DISABLE (#.03) field in the <a href="#policy_file">POLICY (#1.6)</a> file. If it is set to <strong>YES</strong>, the policy and all of its descendant members are <em>not</em> processed when testing or running the policy evaluation API. A disabled policy can also be re-enabled via this action.</p>
<p><span id="_Toc482181908" class="anchor"></span>Figure : Disabling a Policy using the Disable a Policy Action—Sample Prompts and User Entries</p>
<p>Select Action: Quit// <strong>DI &lt;Enter&gt;</strong> Disable Policy</p>
<p>Select Item (1-3): <strong>2 &lt;Enter&gt;</strong> LR CH READ PRELIM</p>
<p>WARNING: Disabling a policy will prevent it and ALL its members from being</p>
<p>processed when data access is being evaluated!</p>
<p>DISABLE: <strong>Y &lt;Enter&gt;</strong> YES</p>
<p>A disabled policy is indicated in the editor by parentheses around the name, as shown in <span class="underline">Figure 12</span>.</p>
<p><span id="_Ref475453412" class="anchor"></span>Figure : DAC Policy Editor—Sample Disabled Policy</p>
<p><span class="underline">Data Access Control Sep 27, 2016@14:02:55 Page: 1 of 1</span></p>
<p>For: &lt;no linked Application Action&gt;</p>
<p><span class="underline">Name Type Result .</span></p>
<p>1 -LR CH READ policy</p>
<p>2 (LR CH READ PRELIM) rule PERMIT</p>
<p>3 LR CH READ FINAL rule PERMIT</p>
<p>. Enter ?? for more actions .</p>
<p>Add/Remove Members Expand/Collapse Test Policy</p>
<p>Edit a Policy Inquiry Disable a Policy</p>
<p>Delete a Policy Functions Select New Policy</p>
<p>Link to Appl Action Quit</p>
<p>Select Action: Quit//</p>
<h2 id="expandcollapse">Expand/Collapse</h2>
<p>The <strong>Expand/Collapse</strong> action toggles the display to expanding a policy to see all of its rules or collapsing the members. A “<strong>+</strong>” preceding the policy name indicates that it has members that are collapsed together, as shown in Figure 14.</p>
<p><span id="_Toc482181910" class="anchor"></span>Figure : Collapsing Members of a Policy using the Expand/Collapse Action—Sample Prompts and User Entries</p>
<p>Select Action: Quit// <strong>EX &lt;Enter&gt;</strong> Expand/Collapse</p>
<p>Select Item(s): (1-3): <strong>1</strong></p>
<p>Re-building the list...</p>
<p><span id="_Ref475453587" class="anchor"></span>Figure : DAC Policy Editor—Sample Display of a Policy with Members Collapsed together</p>
<p><span class="underline">Data Access Control Sep 27, 2016@14:05:13 Page: 1 of 1</span></p>
<p>For: &lt;no linked Application Action&gt;</p>
<p><span class="underline">Name Type Result .</span></p>
<p>1 +LR CH READ policy</p>
<p>. Enter ?? for more actions .</p>
<p>Add/Remove Members Expand/Collapse Test Policy</p>
<p>Edit a Policy Inquiry Disable a Policy</p>
<p>Delete a Policy Functions Select New Policy</p>
<p>Link to Appl Action Quit</p>
<p>Select Action: Quit//</p>
<h2 id="inquiry">Inquiry</h2>
<p>The <strong>Inquiry</strong> action displays a snapshot of the selected item in VA FileMan captioned format. In addition, the Inquiry action also lists all policies or sets to which the selected item is itself a member.</p>
<p><span id="_Toc482181912" class="anchor"></span>Figure : Using the Inquiry Action—Sample Prompts and User Entries</p>
<p>Select Action: Quit// <strong>IN &lt;Enter&gt;</strong> Inquiry</p>
<p>Select Item (1-3): <strong>3 &lt;Enter&gt;</strong> LR CH READ FINAL</p>
<p>NAME: LR CH READ FINAL TYPE: rule</p>
<p>CONDITION CONJUNCTION: OR RESULT: PERMIT</p>
<p>TARGET: 1 ATTRIBUTE: resultStatus</p>
<p>VALUE: F</p>
<p>CONDITION: 1 FUNCTION: DI HAS KEY</p>
<p>VALUE: PROVIDER</p>
<p>CONDITION: 2 FUNCTION: DI HAS KEY</p>
<p>VALUE: LRLAB</p>
<p>DENY MESSAGE: |DIUSRNM| is not authorized to view lab results.</p>
<p>MEMBER OF:</p>
<p>LR CH READ</p>
<p>Enter RETURN to continue or '^' to exit:</p>
<h2 id="functions-1">Functions</h2>
<p>Use the <strong>Functions</strong> action in the Policy Editor to review existing functions, or create new ones. It is <em>highly recommended</em> when creating your own functions to document all input and output variables, including source fields, in the Description. VA FileMan reserves the internal entry numbers less than 1000 for its own use, and those functions are <em>not</em> editable. You can also assign the function to a policy from within this option, without having to go back into the Edit screens.</p>
<p><span id="_Toc482181913" class="anchor"></span>Figure : Using the Functions Action—Sample Prompts and User Entries</p>
<p>Select Action: Quit// <strong>F &lt;Enter&gt;</strong> Functions</p>
<p>Select POLICY FUNCTION: <strong>LRCH ATTRIBUTES</strong></p>
<p>Are you adding 'LRCH ATTRIBUTES' as a new POLICY FUNCTION (the 8TH)? No// <strong>Y &lt;Enter&gt;</strong> (Yes)</p>
<p>POLICY FUNCTION NUMBER: 1007// <strong>&lt;Enter&gt;</strong></p>
<p>POLICY FUNCTION TYPE: <strong>A &lt;Enter&gt;</strong> ATTRIBUTE</p>
<p>NAME: LRCH ATTRIBUTES// <strong>&lt;Enter&gt;</strong></p>
<p>DISPLAY NAME: <strong>Get Lab CH Attributes</strong></p>
<p>EXECUTE CODE: <strong>D GETCH^LRZTEST</strong></p>
<p>DESCRIPTION:</p>
<p>1&gt; <strong>&lt;Enter&gt;</strong></p>
<p>Do you want to assign this ATTRIBUTE function to a policy? <strong>Y &lt;Enter&gt;</strong> YES</p>
<p>Select POLICY: <strong>LR CH READ</strong></p>
<p>ATTRIBUTE FUNCTION: <strong>LRCH ATTRIBUTES &lt;Enter&gt;</strong> ATTRIBUTE</p>
<p>Select POLICY: <strong>&lt;Enter&gt;</strong></p>
<p>Select POLICY FUNCTION:</p>
<h2 id="application-actions-1">Application Actions</h2>
<p>Use the <strong>Link To Appl Action</strong> action in the Policy Editor to assign the policy to an Application Action. A new Application Action can be created here, but it may be helpful to first use the <strong>Set Up Application Actions</strong> option [DIAC ACTIONS] on the Data Access Control menu [DIACCESS]; this option provides full access to the <a href="#application_action_file">APPLICATION ACTIONS (#1.61)</a> file for creating and managing the actions supported by each application that require data access policies.</p>
<p><img src="./media/image2.png" title="Note" alt="Note" style="width:0.3125in;height:0.3125in" /> <strong>REF:</strong> For more information on the Data Access Control menu and associated options, see the “<span class="underline">Data Access Control Menu [DIACCESS]</span>” section.</p>
<p><span id="_Toc482181914" class="anchor"></span>Figure : Setting Application Actions using the Link to Appl Action—Sample Prompts and User Entries</p>
<p>Select Action: Quit// <strong>L &lt;Enter&gt;</strong> Link to Appl Action</p>
<p>No Application Actions are linked to LR CH READ.</p>
<p>Select APPLICATION ACTION: <strong>LRCH READ &lt;Enter&gt;</strong> 63.04 read</p>
<p>POLICY: <strong>LR CH READ</strong></p>
<p>Select APPLICATION ACTION:</p>
<p>Press <strong>Enter</strong> when finished to exit editing and redisplay the list; note the change in the header area as shown in <span class="underline">Figure 18</span>.</p>
<p><span id="_Ref475455268" class="anchor"></span>Figure : DAC Policy Editor—Sample Policy with Linked Application Actions</p>
<p><span class="underline">Data Access Control Sep 27, 2016@14:07:21 Page: 1 of 1</span></p>
<p>For: #63.04, View Chemistry results</p>
<p><span class="underline">Name Type Result .</span></p>
<p>1 -LR CH READ policy First Applicable</p>
<p>2 LR CH READ PRELIM rule PERMIT</p>
<p>3 LR CH READ FINAL rule PERMIT</p>
<p>. Enter ?? for more actions .</p>
<p>Add/Remove Members Expand/Collapse Test Policy</p>
<p>Edit a Policy Inquiry Disable a Policy</p>
<p>Delete a Policy Functions Select New Policy</p>
<p>Link to Appl Action Quit</p>
<p>Select Action: Quit//</p>
<p>If the current policy being edited is assigned to an action, the File# and Short Description is shown in the header of the Policy Editor, as a reminder of the purpose of this policy (see <span class="underline">Figure 18</span>).</p>
<h2 id="test-policy">Test Policy</h2>
<p>The Policy Editor includes a <strong>Test Policy</strong> action to test a policy. It has an optional trace feature that shows the details of policy execution, including local variables. The output is displayed in the VA FileMan Browser, as shown in <span class="underline">Figure 19</span>.</p>
<p><span id="_Ref475451922" class="anchor"></span>Figure : Test Policy Action—Sample Prompts, User Entries, and Output Displayed in the VA FileMan Browser</p>
<p>Select Action: Quit// <strong>TE &lt;Enter&gt;</strong> Test Policy</p>
<p>Enter values to use for testing evaluation of LR CH READ,</p>
<p>either a valid IENS string and/or target attributes.</p>
<p>IENS: <strong>&lt;Enter&gt;</strong></p>
<p>ATTRIBUTE: <strong>?</strong></p>
<p>Enter an attribute/value pair for testing evaluation of this policy.</p>
<p>Target attributes used within this policy are:</p>
<p>resultStatus</p>
<p>ATTRIBUTE: <strong>resultStatus</strong></p>
<p>VALUE: <strong>P</strong></p>
<p>ATTRIBUTE: <strong>&lt;Enter&gt;</strong></p>
<p>Select Test User: FMUSER,ONE// <strong>&lt;Enter&gt;</strong> FM1 TESTER</p>
<p>Show a trace of all policies and rules evaluated? <strong>Y &lt;Enter&gt;</strong> YES</p>
<p>. LR CH READ .</p>
<p>DIACT = 5</p>
<p>DIACTN = read</p>
<p>DIENS =</p>
<p>DIFN = 63.04</p>
<p>DIPOL = 1</p>
<p>DIUSR = 1000406</p>
<p>DIVAL("resultStatus") = P</p>
<p>LR CH READ: DIPOL=1 (DIFN=63.04 &amp; DIACTN=read)</p>
<p>LR READ FINAL: &lt;not a match&gt;</p>
<p>LR READ PRELIM: resultStatus=P</p>
<p>DI HAS KEY(LRLAB): 0</p>
<p>DIRESULT: D</p>
<p>LR CH READ: First Applicable</p>
<p>Result: DENY</p>
<p>DIMSG: 2</p>
<p>FMUSER,ONE is not authorized to view preliminary results.</p>
<p>Please contact Lab staff.</p>
<p>Col&gt; 1 |&lt;PF1&gt;H=Help &lt;PF1&gt;E=Exit| Line&gt; 20 of 20 Screen&gt; 1 of 1</p>
<h3 id="test-utility-output">Test Utility Output</h3>
<p>If you answered <strong>YES</strong> to showing the execution trace, the first thing shown in the VA FileMan Browser is a list of the local DI variables in use. For example:</p>
<p><span id="_Toc482181917" class="anchor"></span>Figure : Test Policy Action—Sample DI Variables in Use</p>
<p>DIACT = 5</p>
<p>DIACTN = read</p>
<p>DIENS =</p>
<p>DIFN = 63.04</p>
<p>DIPOL = 1</p>
<p>DIUSR = 1000406</p>
<p>DIVAL("resultStatus") = P</p>
<p>Second, the execution trace itself is displayed, indenting each level while drilling down into the hierarchy. For example:</p>
<p><span id="_Toc482181918" class="anchor"></span>Figure : Test Policy Action—Sample Execution Trace</p>
<p>LR CH READ: DIPOL=1 (DIFN=63.04 &amp; DIACTN=read)</p>
<p>LR READ FINAL: &lt;not a match&gt;</p>
<p>LR READ PRELIM: resultStatus=P</p>
<p>DI HAS KEY(LRLAB): 0</p>
<p>DIRESULT: D</p>
<p>LR CH READ: First Applicable</p>
<p>The caption is the name of the policy, rule, or function being evaluated; its result is shown to the right of the colon:</p>
<ul>
<li><p>For the top-level policy, the result is the matching policy’s IEN in local variable <strong>DIPOL</strong>. In the Policy Editor, this is simply the main policy being edited. In practice, this would be the policy found by looking up the File# and Action in the <a href="#application_action_file">APPLICATION ACTION (#1.61)</a> file.</p></li>
<li><p>Each member policy or rule shows the targets that matched to apply it or “&lt;not a match&gt;”.</p></li>
<li><p>Any condition function evaluated is displayed with the rule’s Value in parentheses and the Boolean result after execution.</p></li>
<li><p>When a result is determined for the rule, it is stored in the local variable <strong>DIRESULT</strong>.</p></li>
<li><p>As each policy is exited, it is re-displayed in the list with its Result Function.</p></li>
</ul>
<p>The final result of the policy is always shown. For example:</p>
<p><span id="_Toc482181919" class="anchor"></span>Figure : Test Policy Action—Final Result</p>
<p>Result: DENY</p>
<p>Possible results are:</p>
<ul>
<li><p><strong>P—</strong>Permit</p></li>
<li><p><strong>D—</strong>Deny</p></li>
<li><p><strong>-1—</strong>Error</p></li>
<li><p><strong>Null—</strong>Unknown</p></li>
</ul>
<p>Any messages generated based on the result are displayed next, under <strong>DIMSG</strong> with the number of lines. For example:</p>
<p><span id="_Toc482181920" class="anchor"></span>Figure : Test Policy Action—Sample Messages Generated Based on the Result</p>
<p>DIMSG: 2</p>
<p>FMUSER,ONE is not authorized to view preliminary results.</p>
<p>Please contact Lab staff.</p>
<p>Similarly, any error messages that occurred are listed under <strong>DIERR</strong> with the error count.</p>
<p>Finally, the Available Fields strings are displayed as <strong>DIFLDS</strong>, if defined, with the name of the rule, policy, or action it came from in parentheses. Any Additional Fields are listed below in the DR array format:</p>
<p>DIFLDS(level,subfile#,n) = field string</p>
<h2 id="select-new-policy">Select New Policy</h2>
<p>The <strong>Select New Policy</strong> action allows the user to change the policy that is displayed in the list for editing. A different policy can be selected from the <a href="#policy_file">POLICY (#1.6)</a> file, or a brand new one can be created as shown earlier on entry to the Policy Editor. The screen will re-display with the new policy and any currently existing members, ready for editing.</p>
<p><span id="_Toc482181921" class="anchor"></span>Figure : Select New Policy Action—Sample Prompts and User Entries</p>
<p>Select Action: Quit// <strong>SE &lt;Enter&gt;</strong> Select New Policy</p>
<p>Select POLICY: <strong>LR MI READ</strong></p>
<p>Located in the LR (LAB SERVICE) namespace.</p>
<p>Are you adding 'LR MI READ' as a new POLICY (the 4TH)? No// <strong>Y &lt;Enter&gt;</strong> (Yes)</p>
<p>POLICY TYPE: <strong>P &lt;Enter&gt;</strong> policy</p>
<p><span id="_Toc482181922" class="anchor"></span>Figure : DAC Policy Editor—Sample New Policy</p>
<p><span class="underline">Data Access Control Sep 27, 2016@14:10:25 Page: 1 of 1</span></p>
<p>For: &lt;no linked Application Action&gt;</p>
<p><span class="underline">Name Type Result .</span></p>
<p>1 LR MI READ policy</p>
<p>. Enter ?? for more actions .</p>
<p>Add/Remove Members Expand/Collapse Test Policy</p>
<p>Edit a Policy Inquiry Disable a Policy</p>
<p>Delete a Policy Functions Select New Policy</p>
<p>Link to Appl Action Quit</p>
<p>Select Action: Quit//</p>
<h2 id="policy-sets">Policy Sets</h2>
<p>If more complex policies are needed, policies can be grouped into sets. Sets are simply groups of policies or other sets, and each <em>must</em> have its own Result Function. A set can also:</p>
<ul>
<li><p>Have its own Attribute Function and target attributes.</p></li>
<li><p>Return a message.</p></li>
<li><p>Define the Available Fields.</p></li>
<li><p>Be linked to an Application Action for data access evaluation.</p></li>
</ul>
<p>For example, Lab may wish to create a set to handle all reads from the LAB DATA (#63) file. A policy similar to LR CH READ could be created for each lab section that might include a target of “labSection” to determine which policy applies to the read request.</p>
<p><span id="_Toc482181923" class="anchor"></span>Figure : DAC Policy Editor—Sample Policy Sets</p>
<p><span class="underline">Data Access Control Sep 27, 2016@14:31:16 Page: 1 of 1</span></p>
<p>For: #63, View Lab Data file</p>
<p><span class="underline">Name Type Result .</span></p>
<p>1 -LR READ set First Applicable</p>
<p>2 +LR CH READ policy First Applicable</p>
<p>3 LR MI READ policy First Applicable</p>
<p>4 LR SP READ policy First Applicable</p>
<p>5 LR CY READ policy First Applicable</p>
<p>6 LR EM READ policy First Applicable</p>
<p>. Enter ?? for more actions .</p>
<p>Add/Remove Members Expand/Collapse Test Policy</p>
<p>Edit a Policy Inquiry Disable a Policy</p>
<p>Delete a Policy Functions Select New Policy</p>
<p>Link to Appl Action Quit</p>
<p>Select Action: Quit//</p>
<h1 id="data-access-control-menu-diaccess">Data Access Control Menu [DIACCESS]</h1>
<p>The DAC also provides a separate Data Access Control menu [DIACCESS]. This menu contains options that allow creation and management of Data Access Control policies for VistA files. This menu contains the following options (listed in the order of appearance on the menu):</p>
<ul>
<li><p><span class="underline">Set Up Application Actions</span> [DIAC ACTIONS]</p></li>
<li><p><span class="underline">Edit/Create an Action Policy</span> [DIAC EDIT]</p></li>
<li><p><span class="underline">Test a Policy</span> [DIAC TEST]</p></li>
<li><p><span class="underline">Disable a Policy</span> [DIAC DISABLE]</p></li>
<li><p><span class="underline">Delete a Policy</span> [DIAC DELETE]</p></li>
<li><p><span class="underline">Print Actions/Policies</span> [DIAC PRINT]</p></li>
<li><p><span class="underline">Policy Functions</span> [DIAC FUNCTIONS]</p></li>
</ul>
<h2 id="set-up-application-actions">Set Up Application Actions</h2>
<p>The <strong>Set Up Application Actions</strong> option [DIAC ACTIONS] provides access to the <a href="#application_action_file">APPLICATION ACTION (#1.61)</a> file, which allows the user to edit an existing or create a new Application Action, as shown in <span class="underline">Figure 27</span>.</p>
<p><span id="_Ref476567063" class="anchor"></span>Figure : Set Up Application Actions Option—Sample Prompts and User Entries</p>
<p>Select Data Access Control &lt;TEST ACCOUNT&gt; Option: <strong>SET UP &lt;Enter&gt;</strong> Application Actions</p>
<p>Select APPLICATION ACTION: <strong>??</strong></p>
<p>Choose from:</p>
<p>LR READ 63 read</p>
<p>LRCH READ 63.04 read</p>
<p>OR DISCONTINUE 100 disc</p>
<p>OR FLAG 100.008 flag</p>
<p>OR HOLD 100 hold</p>
<p>TIU VIEW 8925 view</p>
<p>YS MH VIEW 601.71 view</p>
<p>You may enter a new APPLICATION ACTION, if you wish</p>
<p>The formal unique name of the action, prefaced with the package namespace</p>
<p>specified in the PACKAGE file, or the letter Z or A.</p>
<p>Select APPLICATION ACTION: <strong>LRCH READ &lt;Enter&gt;</strong> 63.04 read</p>
<p>NAME: LRCH READ FILE#: 63.04</p>
<p>API NAME: read TYPE: READ</p>
<p>POLICY: LR CH READ</p>
<p>SHORT DESCRIPTION: View Chemistry results</p>
<p>NAME: LRCH READ// <strong>&lt;Enter&gt;</strong></p>
<p>FILE#: 63.04// <strong>&lt;Enter&gt;</strong></p>
<p>API NAME: read// <strong>&lt;Enter&gt;</strong></p>
<p>TYPE: READ// <strong>&lt;Enter&gt;</strong></p>
<p>SHORT DESCRIPTION: View Chemistry results Replace <strong>&lt;Enter&gt;</strong></p>
<p>AVAILABLE FIELDS: <strong>&lt;Enter&gt;</strong></p>
<p>Select APPLICATION ACTION:</p>
<h2 id="editcreate-an-action-policy">Edit/Create an Action Policy</h2>
<p>The <strong>Edit/Create an Action Policy</strong> option [DIAC EDIT] provides access to the DAC Policy Editor.</p>
<p><span id="_Toc482181925" class="anchor"></span>Figure : Edit/Create an Action Policy Option—Sample Prompts and User Entries</p>
<p>Select Data Access Control &lt;TEST ACCOUNT&gt; Option: <strong>EDIT &lt;Enter&gt;</strong> /Create an Action Policy</p>
<p>Select POLICY: <strong>LR CH READ</strong></p>
<p>1 LR CH READ policy</p>
<p>2 LR CH READ FINAL rule</p>
<p>3 LR CH READ PRELIM rule</p>
<p>CHOOSE 1-3: <strong>1 &lt;Enter&gt;</strong> LR CH READ policy</p>
<p><span class="underline"><strong>Data Access Control</strong> Mar 06, 2017@12:28:13 Page: 1 of 1 </span></p>
<p>For: #63.04, View Chemistry results</p>
<p><span class="underline">Name Type Result </span></p>
<p>1 -LR CH READ policy First Applicable</p>
<p>2 LR CH READ FINAL rule PERMIT</p>
<p>3 LR CH READ PRELIM rule PERMIT</p>
<p>Enter ?? for more actions</p>
<p>Add/Remove Members Expand/Collapse Test Policy</p>
<p>Edit a Policy Inquiry Disable a Policy</p>
<p>Delete a Policy Functions Select New Policy</p>
<p>Link to Appl Action Quit</p>
<p>Select Action: Quit//</p>
<p><img src="./media/image2.png" title="Note" alt="Note" style="width:0.3125in;height:0.3125in" /> <strong>REF:</strong> For more information on the Policy Editor and associated actions, see the “<span class="underline">Policy Editor</span>” section.</p>
<h2 id="test-a-policy">Test a Policy</h2>
<p>The <strong>Test a Policy</strong> option [DIAC TEST] allows users to test a DAC policy.</p>
<p><img src="./media/image2.png" title="Note" alt="Note" style="width:0.3125in;height:0.3125in" /> <strong>REF:</strong> For more information on the <strong>Test a Policy</strong> option functionality, see the “<span class="underline">Test Policy</span>” section.</p>
<h2 id="disable-a-policy-1">Disable a Policy</h2>
<p>The <strong>Disable a Policy</strong> option [DIAC DISABLE] provides a way to quickly disable a DAC policy.</p>
<p><img src="./media/image2.png" title="Note" alt="Note" style="width:0.3125in;height:0.3125in" /> <strong>REF:</strong> For more information on the <strong>Disable a Policy</strong> option functionality, see the “<span class="underline">Disable a Policy</span>” section.</p>
<h2 id="delete-a-policy-1">Delete a Policy</h2>
<p>The <strong>Delete a Policy</strong> option [DIAC DELETE] allows users to delete a DAC policy.</p>
<p><img src="./media/image2.png" title="Note" alt="Note" style="width:0.3125in;height:0.3125in" /> <strong>REF:</strong> For more information on the <strong>Delete a Policy</strong> option functionality, see the “<span class="underline">Delete a Policy</span>” section.</p>
<h2 id="print-actionspolicies">Print Actions/Policies</h2>
<p>The <strong>Print Actions/Policies</strong> option [DIAC PRINT] allows users to print a summary list of application actions and their associated policies, or details of one policy.</p>
<p>The summary data in <span class="underline">Figure 29</span> is obtained from the <a href="#application_action_file">APPLICATION ACTION (#1.61)</a> file.</p>
<p><span id="_Ref477247630" class="anchor"></span>Figure : Print Actions/Policies Option—Sample Prompts and User Entries: Summary</p>
<p>Select Data Access Control &lt;TEST ACCOUNT&gt; Option: <strong>PRINT &lt;Enter&gt;</strong> Actions/Policies</p>
<p>Print (S)ummary by Application Action, or (D)etails of a Policy? <strong>S &lt;Enter&gt;</strong> UMMARY</p>
<p>LIST ACTIONS by: NAME// <strong>&lt;Enter&gt;</strong></p>
<p>Start with NAME: FIRST// <strong>OR</strong></p>
<p><strong>Go to</strong> NAME: LAST// <strong>ORZ</strong></p>
<p>Within NAME, LIST ACTIONS by: <strong>&lt;Enter&gt;</strong></p>
<p>DEVICE: <strong>;;9999999 &lt;Enter&gt;</strong> NETWORK</p>
<p>APPLICATION ACTION LIST MAR 06, 2017@12:06 PAGE 1</p>
<p>NAME FILE# API NAME POLICY</p>
<p>--------------------------------------------------------------------------------</p>
<p>OR DISCONTINUE 100 disc OR DISCONTINUE</p>
<p>OR FLAG 100.008 flag OR FLAG</p>
<p>OR HOLD 100 hold OR HOLD ORDERS</p>
<p>The detail data in <span class="underline">Figure 30</span> is obtained from the following files:</p>
<ul>
<li><p><a href="#policy_file">POLICY (#1.6)</a>—Primary policy source</p></li>
<li><p><a href="#policy_function_file">POLICY FUNCTION (#1.62)</a>—Related policy functions</p></li>
<li><p><a href="#application_action_file">APPLICATION ACTION (#1.61)</a>—Related policy actions</p></li>
</ul>
<p><span id="_Ref477247654" class="anchor"></span>Figure : Print Actions/Policies Option—Sample Prompts and User Entries: Detailed</p>
<p>Select Data Access Control &lt;TEST ACCOUNT&gt; Option: <strong>PRINT &lt;Enter&gt;</strong> Actions/Policies</p>
<p>Print (S)ummary by Application Action, or (D)etails of a Policy? <strong>D &lt;Enter&gt;</strong> DETAILED</p>
<p>Select POLICY: <strong>LR CH READ</strong></p>
<p>1 LR CH READ policy</p>
<p>2 LR CH READ FINAL rule</p>
<p>3 LR CH READ PRELIM rule</p>
<p>CHOOSE 1-3: <strong>1 &lt;Enter&gt;</strong> LR CH READ policy</p>
<p>DEVICE: HOME// <strong>;;999999 &lt;Enter&gt;</strong> NETWORK</p>
<p>LR CH READ MAR 06, 2017 12:17 PAGE 1</p>
<p>-------------------------------------------------------------------------------</p>
<p>APPLICATION ACTION: LRCH READ TYPE: READ</p>
<p>FILE#: 63.04 API NAME: read</p>
<p>SHORT DESCRIPTION: View Chemistry results</p>
<p>POLICY: LR CH READ RESULT: DI FIRST APPLICABLE</p>
<p>ATTRIBUTES: LRCH ATTRIBUTES</p>
<p>TARGETS:</p>
<p>1: labSection = CH</p>
<p>DENY MESSAGE: Please contact Lab staff.</p>
<p>PERMIT FUNCTION: LR ACCESS</p>
<p>RULES:</p>
<p>1: LR CH READ FINAL RESULT: PERMIT</p>
<p>TARGETS:</p>
<p>1: resultStatus = F</p>
<p>CONDITIONS (OR):</p>
<p>1: DI HAS KEY (PROVIDER)</p>
<p>2: DI HAS KEY (LRLAB)</p>
<p>DENY MESSAGE: |DIUSRNM| is not authorized to view lab results.</p>
<p>2: LR CH READ PRELIM RESULT: PERMIT</p>
<p>TARGETS:</p>
<p>1: resultStatus = P</p>
<p>CONDITIONS:</p>
<p>1: DI HAS KEY (LRLAB)</p>
<p>DENY MESSAGE: |DIUSRNM| is not authorized to view preliminary results.</p>
<p>FUNCTION: LRCH ATTRIBUTES TYPE: ATTRIBUTE</p>
<p>DISPLAY NAME: Get Lab CH Attributes</p>
<p>EXECUTE CODE: Q</p>
<p>DESCRIPTION:</p>
<p>placeholder for testing</p>
<p>FUNCTION: DI HAS KEY TYPE: CONDITION</p>
<p>DISPLAY NAME: User Holds Key</p>
<p>EXECUTE CODE: S Y=$D(^XUSEC(X,+DIUSR))</p>
<p>DESCRIPTION:</p>
<p>Requires X = Security Key #19.1 Name</p>
<p>Returns Y = $D(^XUSEC(X,+DIUSER))</p>
<p>FUNCTION: LR ACCESS TYPE: OBLIGATION</p>
<p>DISPLAY NAME: Log access to Lab Data file</p>
<p>EXECUTE CODE: Q</p>
<p>DESCRIPTION:</p>
<p>placeholder for testing</p>
<p>FUNCTION: DI FIRST APPLICABLE TYPE: RESULT</p>
<p>DISPLAY NAME: First Applicable</p>
<p>EXECUTE CODE: I DIRESULT'="" S Y=1</p>
<p>DESCRIPTION:</p>
<p>Quit when any result is determined</p>
<p>Set Up Application Actions</p>
<p>Edit/Create an Action Policy</p>
<p>Test a Policy</p>
<p>Disable a Policy</p>
<p>Delete a Policy</p>
<p>Print Actions/Policies</p>
<p>Policy Functions</p>
<p>Select Data Access Control &lt;TEST ACCOUNT&gt; Option:</p>
<h2 id="policy-functions">Policy Functions</h2>
<p>The <strong>Policy Functions</strong> option [DIAC FUNCTIONS] provides access to the <a href="#policy_function_file">POLICY FUNCTION (#1.62)</a> file, which allows the user to edit an existing or create a new Policy Function, as shown in <span class="underline">Figure 31</span>.</p>
<p><span id="_Ref476566553" class="anchor"></span>Figure : Policy Functions Option—Sample Prompts and User Entries</p>
<p>Select Data Access Control &lt;TEST ACCOUNT&gt; Option: <strong>POLICY &lt;Enter&gt;</strong> Functions</p>
<p>Select POLICY FUNCTION: <strong>LRCH ATTRIBUTES &lt;Enter&gt;</strong> ATTRIBUTE</p>
<p>NUMBER: 1002 NAME: LRCH ATTRIBUTES</p>
<p>DISPLAY NAME: Get Lab CH Attributes TYPE: ATTRIBUTE</p>
<p>EXECUTE CODE: Q</p>
<p>DESCRIPTION:</p>
<p>placeholder for testing</p>
<p>NAME: LRCH ATTRIBUTES// <strong>&lt;Enter&gt;</strong></p>
<p>DISPLAY NAME: Get Lab CH Attributes Replace <strong>&lt;Enter&gt;</strong></p>
<p>EXECUTE CODE: Q// <strong>&lt;Enter&gt;</strong></p>
<p>DESCRIPTION:</p>
<p>placeholder for testing</p>
<p>Edit? NO// <strong>&lt;Enter&gt;</strong></p>
<p>Do you want to assign this ATTRIBUTE function to a policy? <strong>&lt;Enter&gt;</strong></p>
<p>Select POLICY FUNCTION:</p>
<p><img src="./media/image2.png" title="Note" alt="Note" style="width:0.3125in;height:0.3125in" /> <strong>REF:</strong> For a list of exported DI* functions, see “<span class="underline">Appendix B—Exported DI* Functions</span>.”</p>
<h1 id="application-programming-interface-api">Application Programming Interface (API)</h1>
<h2 id="candodiac1-policy-evaluation">$$CANDO^DIAC1(): Policy Evaluation</h2>
<p>Once a policy has been created and tested, it is ready to be used by the new VA FileMan Web service or within an application’s own code. The $$CANDO^DIAC1 API evaluates a policy to determine if the action being attempted is permitted.</p>
<p>If a matching entry exists in the <a href="#application_action_file">APPLICATION ACTION (#1.61)</a> file for the requested action and specified file or sub-file, its policy is evaluated to determine the user’s authorization to access the file and/or record. Policy rules are evaluated in sequence, and processing continues until the stop criteria for the policy is met.</p>
<p>Format</p>
<p>$$CANDO^DIAC1(file,iens,action[,user][,.value][,.fields][,msg_root][,err_root])</p>
<p>Input Parameters</p>
<p>file: (Required) A VistA file number or sub-file number.</p>
<p>iens: (Required/Optional) Standard IENS string indicating internal entry numbers. It is required if evaluating an action on an existing record.</p>
<p>action: (Required) The API name of the action to be taken on the record; the <strong>file</strong> and <strong>action</strong> parameters should identify an entry in the <a href="#application_action_file">APPLICATION ACTION (#1.61)</a> file.</p>
<p>user: (Optional) Pointer to the NEW PERSON (#200) file; defaults to the current value of DUZ if <em>not</em> defined.</p>
<p>value(name): (Optional) Array of additional attribute values to use when evaluating policies, passed by reference in the form:</p>
<p>VALUE(“name”) = “value”</p>
<p>The name-value pairs could match target attributes in the policy for supplementing the results of the Attribute Function, or simply be additional values used by other functions or messages.</p>
<p>fields: (Optional) Local variable that receives output from the call. If the Available Fields have been defined for the application action and its policy returns a permit result, that field string is be returned. If Available Fields have been defined for the policy or rule that determined the result, that string takes precedence over the action’s and be returned instead. Additional Fields can also be returned here, as an array of the same name subscripted by the file or sub-file number.</p>
<p><img src="./media/image2.png" title="Note" alt="Note" style="width:0.3125in;height:0.3125in" /> <strong>NOTE:</strong> This variable is killed at the beginning of each call.</p>
<p>msg_root: (Optional) Closed root into which any relevant advice messages is returned. If this parameter is <em>not</em> passed, the array is put into nodes descendant from ^TMP(“DIMSG”,$J).</p>
<p>err_root: (Optional) Closed root into which the error messages are returned. If this parameter is <em>not</em> passed, the array is put into nodes descendant from ^TMP(“DIERR”,$J).</p>
<p>Output</p>
<p>This Boolean extrinsic function returns the following:</p>
<ul>
<li><p><strong>1—</strong>If authorization is permitted (Permit).</p></li>
<li><p><strong>0—</strong>If authorization is denied (Deny).</p></li>
<li><p><strong>Null—</strong>If authorization <em>cannot</em> be determined (i.e., no policies exist in the <a href="#policy_file">POLICY [#1.6]</a> file that apply).</p></li>
<li><p><strong>-1—</strong>Error.</p></li>
</ul>
<p>Advice messages can be returned for either a Permit or Deny result. Available Fields are only returned on a Permit.</p>
<h3 id="examples">Examples</h3>
<p>To check the current user’s authorization to view a chemistry result using our sample Lab policy, a simple call could be made to the API:</p>
<p>&gt;<strong>S OK=$$CANDO^DIAC1(63.04,“7019779.8679,12345,”,“read”) W !,OK</strong></p>
<p>1</p>
<p>A different user may <em>not</em> be permitted to view the result, and the message array can show why:</p>
<p>&gt;<strong>S OK=$$CANDO^DIAC1(63.04,“7019779.8679,12345,”,“read”,1000406,,,“ZZMSG”)</strong></p>
<p>&gt;<strong>W OK,! ZW ZZMSG</strong></p>
<p>0</p>
<p>ZZMSG(1)=“FMUSER,ONE is not authorized to view preliminary results.”</p>
<p>ZZMSG(2)=“Please contact Lab staff.”</p>
<p>An incomplete call to the API returns an error:</p>
<p>&gt;<strong>S OK=$$CANDO^DIAC1(63.04,“7019779.8679,12345,”,,,,,“ZZMSG”,“ZZERR”)</strong></p>
<p>&gt;<strong>W OK,! ZW ZZERR</strong></p>
<p>-1</p>
<p>ZZERR(1)=“The input parameter that identifies the ACTION is missing or invalid.”</p>
<h1 id="appendix-akey-di-variables">Appendix A—Key DI* Variables</h1>
<p>These key DI* variables are either passed into the <span class="underline">$$CANDO^DIAC1(): Policy Evaluation</span> API, or are set by VA FileMan. They can be referenced in function code as read-only, except for the DIVAL array, which <em>must</em> be set by the Attribute Functions.</p>
<p><span id="_Toc482181934" class="anchor"></span>Table : Key DI* Variables</p>
<table>
<caption>Key DI* Variables</caption>
<thead>
<tr class="header">
<th>Variables</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>DIACT</td>
<td>Pointer to the <a href="#application_action_file">APPLICATION ACTION (#1.61)</a> file of the action that matches DIFN and DIACTN.</td>
</tr>
<tr class="even">
<td>DIACTN</td>
<td>The API Name of the action the user is requesting to take on the records, as defined in an <a href="#application_action_file">APPLICATION ACTION (#1.61)</a> file entry for the file.</td>
</tr>
<tr class="odd">
<td>DIENS</td>
<td>The IENS string passed into the API.</td>
</tr>
<tr class="even">
<td>DIERROR</td>
<td>The closed root of an array in which to return errors instead of ^TMP(“DIERR”,$J).</td>
</tr>
<tr class="odd">
<td>DIFCN()</td>
<td>Array holding the Result Function code for each policy in the form DIFCN(IEN)=code, where IEN is the pointer to the <a href="#policy_file">POLICY (#1.6)</a> file of the policy being evaluated. The function’s default value for a null result is held in DIFCN(IEN,“NULL”)=P or D.</td>
</tr>
<tr class="even">
<td>DIFLDS</td>
<td><p>The DR string holding the list of fields that can be accessed on this action; continuation strings or sub-file fields are returned as:</p>
<p>DIFLDS(subfile#,n)=string</p></td>
</tr>
<tr class="odd">
<td>DIFN</td>
<td>The file or sub-file number where the record being evaluated resides.</td>
</tr>
<tr class="even">
<td>DIPOL</td>
<td>Pointer to the <a href="#policy_file">POLICY (#1.6)</a> file of the primary policy being tested or evaluated.</td>
</tr>
<tr class="odd">
<td>DIRESULT</td>
<td><p>The current result of the policy:</p>
<ul>
<li><p><strong>P—</strong>Permit</p></li>
<li><p><strong>D—</strong>Deny</p></li>
<li><p><strong>-1—</strong>Error</p></li>
<li><p><strong>Null—</strong>Unknown</p></li>
</ul></td>
</tr>
<tr class="even">
<td>DITXT</td>
<td>The closed root of an array in which to return messages instead of ^TMP(“DIMSG”,$J).</td>
</tr>
<tr class="odd">
<td>DIUSR</td>
<td>Pointer to the NEW PERSON (#200) file of the user requesting to access the data.</td>
</tr>
<tr class="even">
<td>DIUSRNM</td>
<td>NAME (#.01) field in the NEW PERSON (#200) file of DIUSR.</td>
</tr>
<tr class="odd">
<td>DIVAL()</td>
<td><p>Array holding record attributes as set by the policy’s Attribute Function in the form:</p>
<p>DIVAL(“name”) = “value”</p>
<p>For comparison to the policy’s Target attributes. It can also contain additional values passed into the API or defined during testing.</p></td>
</tr>
</tbody>
</table>
<h1 id="appendix-bexported-di-functions">Appendix B—Exported DI* Functions</h1>
<p><span class="underline">Figure 1</span> lists the entries in the POLICY FUNCTION (#1.62) file that are exported with Patch DI*22.2*8 for national/public/supported use.</p>
<p><span id="_Toc482181929" class="anchor"></span>Figure : Exported DI* Functions</p>
<p>NUMBER: 1 NAME: DI FIRST APPLICABLE</p>
<p>DISPLAY NAME: First Applicable TYPE: RESULT</p>
<p>EXECUTE CODE: I DIRESULT'="" S Y=1</p>
<p>DESCRIPTION:</p>
<p>Quit when any result is determined</p>
<p>NUMBER: 2 NAME: DI DENY OVERRIDE</p>
<p>DISPLAY NAME: Deny Override TYPE: RESULT</p>
<p>EXECUTE CODE: I DIRESULT="D" S Y=1</p>
<p>DESCRIPTION:</p>
<p>Quit when a Deny result is found</p>
<p>NUMBER: 3 NAME: DI DENY UNLESS PERMIT</p>
<p>DISPLAY NAME: Deny Unless Permit TYPE: RESULT</p>
<p>EXECUTE CODE: I DIRESULT="P" S Y=1 NULL VALUE: DENY</p>
<p>DESCRIPTION:</p>
<p>Quit when a Permit result is found; if no result can be determined,</p>
<p>return a Deny result</p>
<p>NUMBER: 4 NAME: DI PERMIT OVERRIDE</p>
<p>DISPLAY NAME: Permit Override TYPE: RESULT</p>
<p>EXECUTE CODE: I DIRESULT="P" S Y=1</p>
<p>DESCRIPTION:</p>
<p>Quit when a Permit result is found</p>
<p>NUMBER: 5 NAME: DI PERMIT UNLESS DENY</p>
<p>DISPLAY NAME: Permit Unless Deny TYPE: RESULT</p>
<p>EXECUTE CODE: I DIRESULT="D" S Y=1 NULL VALUE: PERMIT</p>
<p>DESCRIPTION:</p>
<p>Quit when a Deny result is found; if no result can be determined,</p>
<p>return a Permit result</p>
<p>NUMBER: 6 NAME: DI HAS KEY</p>
<p>DISPLAY NAME: User Holds Key TYPE: CONDITION</p>
<p>EXECUTE CODE: S Y=$D(^XUSEC(X,DIUSR))</p>
<p>DESCRIPTION:</p>
<p>Requires X = Security Key #19.1 Name</p>
<p>Returns Y = $D(^XUSEC(X,DIUSR))</p>
<p>NUMBER: 7 NAME: DI PERSON CLASS</p>
<p>DISPLAY NAME: User is Class Member TYPE: CONDITION</p>
<p>EXECUTE CODE: S Y=$$PCLS^DIACX(X,DIUSR)</p>
<p>DESCRIPTION:</p>
<p>Requires X = Person Class #8932.1 IEN or VA Code</p>
<p>Returns Y = 1 or 0, if X matches DIUSR’s current class assignment</p>
</body>
</html>
